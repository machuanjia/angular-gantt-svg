!function(){"use strict";angular.module("gantt",["gantt.tpl"]).directive("gantt",[function(){return{restrict:"E",transclude:!0,templateUrl:"gantt/gantt.html",controller:["$scope","$element","ganttService","$timeout",function(t,a,e,r){function i(){d.listWidth=d.list.colList.length*d.colWidth+30,d.listCss={width:d.listWidth+"px"},_.forEach(d.list.colList,function(t,a){t.x=d.listColTextStartX+a*d.colWidth,t.y=d.headerHeight/2+7}),_.forEach(d.list.rowList,function(t,a){t.rectX=0,t.rectY=d.headerHeight+a*d.rowHeight,t.rectWidth="100%",t.rectHeight=d.rowHeight,t.x1=0,t.y1=t.rectY+d.rowHeight,t.y2=t.rectY+d.rowHeight,t.textX=d.listRowTextStartX,t.textY=t.rectY+30,t.rectLineX=(moment(t.start).format("X")-moment(t.start).startOf("day").format("X"))*d.subWidth,t.rectLineY=d.headerHeight+a*d.rowHeight+20,t.rectLineWidth=d.subWidth*(moment(t.end).format("X")-moment(t.start).format("X")),t.rectLineHeight=12})}function s(){switch(d.type){case"day":d.mapHeader={title:moment().format("YY-MM-DD"),cols:[]};for(var t=0;t<24;t++)d.mapHeader.cols.push(t+":00");d.mapWidth=d.mapHeader.cols.length*d.colWidth,d.subWidth=d.mapWidth/86400;break;case"month":alert("month");break;case"year":alert("year")}r(function(){$("#gantt-map-svg-wrap").on("scroll",function(){$("#gantt-list-svg-wrap").scrollTop($(this).scrollTop()),$("#gantt-map-header").scrollLeft($(this).scrollLeft())})})}function o(){d.list.rowList=[];for(var t=0;t<1e3;t++)d.list.rowList.push({id:t,name:"任务"+t,charger:"马传佳",start:moment().startOf("day"),end:moment().startOf("day").add(20,"hours")});d.list.rowList,s(),i()}var n=240,d=t.vm={listWidth:240,rowHeight:50,colWidth:80,headerHeight:0,listCss:{width:n+"px"},listColTextStartX:30,listRowTextStartX:30,mapWidth:0,subWidth:0,list:{colList:[{name:"name",display_name:"名称",isStrong:!0},{name:"charger",display_name:"负责人"},{name:"start",display_name:"开始时间"}],rowList:[{id:1,name:"任务1",charger:"马传佳",start:moment().startOf("day"),end:moment().startOf("day").add(1,"hours")},{id:2,name:"任务2",charger:"马传佳",start:moment().startOf("day").add(1,"hours"),end:moment().startOf("day").add(2,"hours")},{id:3,name:"任务3",charger:"马传佳",start:moment().startOf("day").add(1,"hours"),end:moment().startOf("day").add(3,"hours")},{id:4,name:"任务4",charger:"马传佳",start:moment().startOf("day").add(2,"hours"),end:moment().startOf("day").add(4,"hours")},{id:5,name:"任务5",charger:"马传佳",start:moment().startOf("day").add(2,"hours"),end:moment().startOf("day").add(5,"hours")},{id:6,name:"任务6",charger:"马传佳",start:moment().startOf("day").add(9,"hours"),end:moment().startOf("day").add(10,"hours")}]},pageX:0,flag:!1,type:"day"};d.mouseDown=function(t){"gantt-split"===t.target.className&&(d.flag=!0,d.pageX=t.pageX)},d.mouseMove=function(t){d.flag&&(d.listWidth=d.listWidth+(t.pageX-d.pageX),d.listWidth>=600&&(d.listWidth=600,d.flag=!1),d.listCss.width=d.listWidth+"px",d.pageX=t.pageX)},d.mouseUp=function(t){d.pageX=t.pageX,d.flag=!1},d.mapOver=function(t){$(".gantt-list-row.gantt-row.active").removeClass("active");var a=t.target,e=a.id+"-list";$("#"+e).addClass("active")},d.mapLeave=function(t){$(".gantt-list-row.gantt-row.active").removeClass("active")},o()}]}}]).service("ganttService",[function(){}]).filter("timeFormat",[function(){return function(t){return void 0===t||null===t||_.isDate(moment(t))?t:moment(t).format("HH:mm")}}])}();
angular.module("gantt.tpl",[]).run(["$templateCache",function(t){t.put("gantt/gantt.html",'<div class="gantt-wrap" ng-mousedown="vm.mouseDown($event)" ng-mousemove="vm.mouseMove($event)" ng-mouseup="vm.mouseUp($event)">\r    <div class="gantt-list" ng-style="vm.listCss">\r        <div class="gantt-header" ng-style="vm.listCss">\r            <table class="gantt-header-table">\r                <tr>\r                    <td ng-repeat="text in vm.list.colList">\r                        {{text.display_name}}\r                    </td>\r                </tr>\r            </table>\r        </div>\r        <div id="gantt-list-svg-wrap" class="gantt-list-svg-wrap">\r            <svg class="gantt-list-svg"\r                 ng-style="{width:vm.listWidth + \'px\',height:(vm.list.rowList.length * vm.rowHeight + vm.headerHeight) + \'px\'}">\r                <g ng-repeat="row in vm.list.rowList">\r                    <rect class="gantt-list-row gantt-row"\r                          id="{{row.id}}-row-list"\r                          ng-attr-x="{{row.rectX}}"\r                          ng-attr-y="{{row.rectY}}"\r                          ng-attr-width="{{row.rectWidth}}"\r                          ng-attr-height="{{row.rectHeight}}"></rect>\r\r                    <line class="row-line"\r                          ng-attr-x1="{{row.x1}}"\r                          ng-attr-y1="{{row.y1}}"\r                          ng-attr-x2="100%"\r                          ng-attr-y2="{{row.y2}}">\r                    </line>\r\r                    <text ng-repeat="col in vm.list.colList track by $index"\r                          ng-attr-x="{{row.textX + $index*80}}"\r                          ng-attr-y="{{row.textY}}"\r                          class="rol-text" ng-class="{\'true\':\'rol-strong\',false:\'\'}[col.isStrong]">{{row[col.name]}}\r                    </text>\r                </g>\r            </svg>\r        </div>\r    </div>\r    <div class="gantt-split"></div>\r    <div class="gantt-map">\r        <div id="gantt-map-header" class="gantt-header">\r            <table class="gantt-header-table" ng-style="{width:vm.mapHeader.cols.length * vm.colWidth + \'px\'}">\r                <tr>\r                    <td colspan="{{vm.mapHeader.cols.length}}">\r                        {{vm.mapHeader.title}}\r                    </td>\r                </tr>\r                <tr>\r                    <td ng-repeat="col in vm.mapHeader.cols track by $index" width="78">\r                        {{col}}\r                    </td>\r                </tr>\r            </table>\r        </div>\r        <div id="gantt-map-svg-wrap" class="gantt-map-svg-wrap">\r            <svg class="gantt-map-svg"\r                 ng-mouseover="vm.mapOver($event)"\r                 ng-mouseleave="vm.mapLeave($event)"\r                 ng-style="{width:vm.mapHeader.cols.length * vm.colWidth + \'px\',height:(vm.list.rowList.length * vm.rowHeight + vm.headerHeight) + \'px\'}">\r                <g ng-repeat="row in vm.list.rowList">\r                    <rect class="gantt-row"\r                          id="{{row.id}}-row"\r                          ng-attr-x="{{row.rectX}}"\r                          ng-attr-y="{{row.rectY}}"\r                          ng-attr-width="{{row.rectWidth}}"\r                          ng-attr-height="{{row.rectHeight}}"></rect>\r\r                    <line class="row-line"\r                          ng-attr-x1="{{row.x1}}"\r                          ng-attr-y1="{{row.y1}}"\r                          ng-attr-x2="100%"\r                          ng-attr-y2="{{row.y2}}">\r                    </line>\r\r\r                    <rect class="gantt-line"\r                          ng-attr-x="{{row.rectLineX}}"\r                          ng-attr-y="{{row.rectLineY}}"\r                          ng-attr-width="{{row.rectLineWidth}}"\r                          ng-attr-height="{{row.rectLineHeight}}"></rect>\r\r                </g>\r            </svg>\r        </div>\r    </div>\r</div>\r\r\r\r\r\r\r\r')}]);